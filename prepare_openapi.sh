#!/bin/bash
# Скрипт для подготовки OpenAPI JSON файла перед генерацией кода
# Запускает все необходимые Python скрипты для исправления спецификации

set -e  # Остановка при ошибке

JSON_FILE="iikocloud_openapi.json"

echo "=========================================="
echo "Подготовка OpenAPI спецификации"
echo "=========================================="
echo ""

# Проверяем наличие JSON файла
if [ ! -f "$JSON_FILE" ]; then
    echo "Ошибка: Файл $JSON_FILE не найден!"
    exit 1
fi

# 1. Исправление имён схем (удаление недопустимых символов)
echo "[1/5] Исправление имён схем (удаление недопустимых символов)..."
python3 fix_schema_names.py "$JSON_FILE"
echo ""

# 2. Исправление типов данных
echo "[2/5] Исправление типов данных..."
python3 fix_types.py "$JSON_FILE"
echo ""

# 3. Удаление лишних префиксов из имён схем
echo "[3/5] Удаление лишних префиксов из имён схем..."
python3 fix_schema_prefixes.py "$JSON_FILE"
echo ""

# 4. Добавление security схем
echo "[4/5] Добавление security схем..."
python3 add_security.py "$JSON_FILE"
echo ""

# 5. Исправление путей и добавление servers
echo "[5/5] Исправление путей и добавление servers..."
python3 fix_paths_and_servers.py "$JSON_FILE"
echo ""

echo "=========================================="
echo "Подготовка завершена успешно!"
echo "=========================================="
echo ""
echo "Теперь можно запустить генерацию кода:"
echo "  ./codegen.sh"

